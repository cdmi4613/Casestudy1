(()=>{"use strict";var e,t,s={184:(e,t,s)=>{s.r(t),s.d(t,{PcomLegacyCarDataHelperExtension:()=>w,PcomLegacyHelperExtension:()=>v,TestExtension:()=>y,compact:()=>r,isStringNotEmpty:()=>n});var i=Object.defineProperty,a=(e,t,s)=>(((e,t,s)=>{t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const r=e=>e.filter((e=>e)),n=e=>"string"==typeof e&&e.length>0;var o=Object.defineProperty,l=(e,t,s)=>(((e,t,s)=>{t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const h={enabled:!0,level:"warn"};var d=(e=>(e[e.error=0]="error",e[e.warn=1]="warn",e[e.log=2]="log",e))(d||{});const g=class e{constructor(e,t){l(this,"prefix"),l(this,"settings"),this.prefix=e,this.settings={...h,...t}}_getMergedSettings(e){return e?{...this.settings,...e}:this.settings}_isAllowed(t,s){if(!e.isAvailable||!s.enabled)return!1;const i=d[s.level];switch(t){case"error":case"warn":return i>=d[t];case"info":case"log":case"debug":case"dir":return i>=2;default:return!1}}_log(e,t="log",s){const i=this._getMergedSettings(s);this._isAllowed(t,i)&&("dir"===t?(console.log(`[${this.prefix}] ${t}:`),console[t](e)):console[t](`[${this.prefix}] ${e}`))}log(e,t){this._log(e,"log",t)}dir(e,t){this._log(e,"dir",t)}debug(e,t){this._log(e,"debug",t)}error(e,t){this._log(e,"error",t)}info(e,t){this._log(e,"info",t)}warn(e,t){this._log(e,"warn",t)}};l(g,"isAvailable",typeof console<"u");let c=g;const u=(...e)=>{const t={};return e.forEach((e=>{if((e=>{for(const t in e)return!1;return!0})(e))return;const s={...t,...e};let i;for(i in s)"object"!=typeof s[i]||Array.isArray(s[i])?t[i]=s[i]:t[i]={...t[i],...e[i]}})),t};class m{constructor(e="DataLayerExtension",t){l(this,"_logger"),l(this,"_className"),l(this,"_dataLayerInstance"),this._className=e,this._logger=new c(this.className,t)}get dataLayerInstance(){return this._dataLayerInstance}set dataLayerInstance(e){this._dataLayerInstance=e}get className(){return this._className}set className(e){this._className=e}get isRegistered(){return typeof this._dataLayerInstance<"u"}}const p={};class y extends m{constructor(e){super("TestExtension",null==e?void 0:e.logger),a(this,"settings"),this.settings=e?u(p,e):p}test(e="NOT"){return e}}const f={pageLoadEventName:"PAGPCOM_General_Pageload",pageNameSeparator:"/",strictMode:!1};class v extends m{constructor(e){super("PcomLegacyHelperExtension",null==e?void 0:e.logger),a(this,"settings"),a(this,"_isHostAllowedForPageNameCache",{}),a(this,"_didUrlChangeCache",{}),a(this,"_didPathNameChangeCache",{}),this.settings=e?u(f,e):f}_isHostAllowedForPageName(e=window.location.host){const t=this._isHostAllowedForPageNameCache[e]??null;return null!==t?t:this.settings.strictMode?this._isHostAllowedForPageNameCache[e]=/^(www\d?\d?|contact|staging|preview\.ppn|origin-..-www)\.porsche\.com(|\.local)$/i.test(e)||/^(nxdev|prod|staging|ci)-asia\.porsche\.noxum\.cloud$/i.test(e):this._isHostAllowedForPageNameCache[e]=/^.+$/.test(e)}getPageNameByUrl(e=window.location.pathname){if(e=e.replace(/(^\/|\/$)/g,""),this._isHostAllowedForPageName()){const t=[],s=r(e.split("/"));this.settings.pool&&t.push(this.settings.pool),this.settings.language&&t.push(this.settings.language),this.settings.region&&t.push("_"+this.settings.region+"_");for(let e=0;e<t.length&&s.length>0;e++)s[0]===t[e]&&s.shift();return 0===s.length&&s.push("home"),s.join(this.settings.pageNameSeparator)}return e}didUrlChange(e=window.location.href,t="default"){const s=this._didUrlChangeCache[t]??null;return this._didUrlChangeCache[t]=e,s!==e}pushPageLoadOnUrlChange(e){var t;e={force:!1,value:window.location.href,pageLoadEventName:this.settings.pageLoadEventName,id:"default",...e},(this.didUrlChange(e.id,e.value)||e.force)&&(null==(t=this.dataLayerInstance)||t.push(e.pageLoadEventName))}didPathNameChange(e=window.location.pathname,t="default"){const s=this._didPathNameChangeCache[t]??null;return this._didPathNameChangeCache[t]=e,s!==e}pushPageLoadOnPathNameChange(e){var t;e={force:!1,value:window.location.pathname,pageLoadEventName:this.settings.pageLoadEventName,id:"default",...e},(this.didPathNameChange(e.id,e.value)||e.force)&&(null==(t=this.dataLayerInstance)||t.push(e.pageLoadEventName))}}const b={finderUrlRegex:/[?&](modelSeriesKeys|model)=([^&#]*)/i,cacheHit:()=>{}},_={modelRangeCode:void 0,modelRangeName:void 0,modelSeriesCode:void 0,modelSeriesName:void 0,modelCode:void 0,modelName:void 0};class w extends m{constructor(e){var t;super("PcomLegacyCarDataHelperExtension",null==e?void 0:e.logger),a(this,"settings"),a(this,"_isHealthy",!1),a(this,"_cache",{byRangeId:[],bySeriesId:[],byModelId:[],byUrl:[],byModelPageUrl:[],bySimpleModelUrl:[],byFinderUrl:[]}),typeof e>"u"&&this._logger.error("The extension will not work without having the required options of type TPcomLegacyCarDataHelperSettings.");const s=[];null!=e&&e.carData?(e.modelPageBaseUrl||(e.carData.models&&null!=(t=e.carData.models[0])&&t.modelUrl?e.modelPageBaseUrl=e.carData.models[0].modelUrl.replace(/\/models\/.*/,"/models/"):s.push("modelPageBaseUrl")),e.modelPageRegex||(n(e.modelPageBaseUrl)?e.modelPageRegex=new RegExp(`^(https?://)?([^/#?]*/)?(${e.modelPageBaseUrl.replace(/(^\/|models\/$)/g,"")})(models(/[^/?#]*)+)`):s.push("modelPageRegex"))):s.push("carData"),s.length>0&&this._logger.error(`The extension will not work without having the full set of required options of type TPcomLegacyCarDataHelperSettings. Missing options are: ${s.join(", ")}.`),this._isHealthy=0===s.length,this.settings={...b,...e}}get isHealthy(){return this._isHealthy}byRangeId(e){var t;if(!this._isHealthy)return;const s=this._cache.byRangeId.find((t=>t.hash===e));if(s){const t=s.data?{...s.data}:void 0;return this.settings.cacheHit("byRangeId",e,t),t}const i=null==(t=this.settings)?void 0:t.carData.carrange.ranges.find((t=>t.id===e));let a;return i&&(a={..._,modelRangeCode:i.id.toLowerCase(),modelRangeName:i.id}),this._cache.byRangeId.push({hash:e,data:a}),a?{...a}:void 0}bySeriesId(e){var t,s,i;if(!this._isHealthy)return;const a=this._cache.bySeriesId.find((t=>t.hash===e.toString()));if(a){const t=a.data?{...a.data}:void 0;return this.settings.cacheHit("bySeriesId",e,t),t}const r=e instanceof RegExp?null==(t=this.settings)?void 0:t.carData.series.find((t=>e.test(t.id))):null==(s=this.settings)?void 0:s.carData.series.find((t=>t.id===e));let n;if(r){const e=null==(i=r.id.match(/models\/([^/]*)\/?/))?void 0:i[1];n={..._,...e?this.byRangeId(e):{},modelSeriesCode:r.id.replace(/.*?([^/]*)\/$/,"$1"),modelSeriesName:r.title.replace(/&amp;/g,"&")}}return this._cache.bySeriesId.push({hash:e.toString(),data:n}),n?{...n}:void 0}byModelId(e){var t;if(!this._isHealthy)return;const s=this._cache.byModelId.find((t=>t.hash===e));if(s){const t=s.data?{...s.data}:void 0;return this.settings.cacheHit("byModelId",e,t),t}const i=null==(t=this.settings)?void 0:t.carData.models.find((t=>t.id===e));let a;return i&&(a={..._,...this.bySeriesId(i.modelserie),modelCode:i.id,modelName:i.modelname}),this._cache.byModelId.push({hash:e,data:a}),a?{...a}:void 0}byModelCode(e){return this.byModelId(e)}bySimpleModelUrl(e=window.location.href){var t,s;if(!this._isHealthy)return;const i=this._cache.bySimpleModelUrl.find((t=>t.hash===e.toString()));if(i){const t=i.data?{...i.data}:void 0;return this.settings.cacheHit("bySimpleModelUrl",e,t),t}const a=e instanceof RegExp?null==(t=this.settings)?void 0:t.carData.models.find((t=>e.test(t.modelUrl||""))):null==(s=this.settings)?void 0:s.carData.models.find((t=>t.modelUrl===e||t.modelUrl===`${e}/`));let r;return a&&(r=this.byModelId(a.id)),this._cache.bySimpleModelUrl.push({hash:e.toString(),data:r}),r?{...r}:void 0}byModelPageUrl(e=window.location.href){if(!this._isHealthy)return;const t=this._cache.byModelPageUrl.find((t=>t.hash===e));if(t){const s=t.data?{...t.data}:void 0;return this.settings.cacheHit("byModelPageUrl",e,s),s}const s=e.match(this.settings.modelPageRegex);let i;if(s){const e=r(s[4].split("/").slice(1,4));if(n(e[2])){const t=this.settings.modelPageBaseUrl+e.join("/")+"/";i=this.bySimpleModelUrl(t)}if(!i&&n(e[1])){const t=this.settings.modelPageBaseUrl+e.slice(0,2).join("/")+"/";i=this.bySeriesId(t)}!i&&n(e[0])&&(i=this.byRangeId(e[0]))}return this._cache.byModelPageUrl.push({hash:e.toString(),data:i}),i?{...i}:void 0}byFinderUrl(e=window.location.href){if(!this._isHealthy)return;const t=this._cache.byFinderUrl.find((t=>t.hash===e));if(t){const s=t.data?{...t.data}:void 0;return this.settings.cacheHit("byFinderUrl",e,s),s}const s=e.match(this.settings.finderUrlRegex);let i;return s&&n(s[2])&&!s[2].includes(",")&&(i=this.byRangeId(s[2])),this._cache.byFinderUrl.push({hash:e.toString(),data:i}),i?{...i}:void 0}byUrl(e=window.location.href){if(!this._isHealthy)return;const t=this._cache.byUrl.find((t=>t.hash===e));if(t){const s=t.data?{...t.data}:void 0;return this.settings.cacheHit("byUrl",e,s),s}let s;return s=this.byModelPageUrl(e),s||(s=this.byFinderUrl(e)),this._cache.byUrl.push({hash:e.toString(),data:s}),s?{...s}:void 0}}},343:(e,t,s)=>{s.r(t),s.d(t,{CleanExecutionPlace:()=>r,DEFAULT_SETTINGS:()=>n,DataLayerExtension:()=>A,EventNameFactory:()=>o,FrameTicker:()=>p,GlobalDataLayer:()=>B,GlobalDataLayerBaseClass:()=>O,Logger:()=>w,PageNameExtenderExtension:()=>H,ViewportTrackerExtension:()=>V,ViewportTrackerStatusChangeEvent:()=>k,WebPropertiesFactory:()=>P,clean:()=>c,cleanByDataLayerPaths:()=>u,each:()=>h,eachFirstLevel:()=>l,executeEachFunction:()=>m,get:()=>y,getDataLayerPaths:()=>f,getWebProperties:()=>U,isEmpty:()=>g,isEmptyDataLayer:()=>d,merge:()=>E,validate:()=>F});var i=Object.defineProperty,a=(e,t,s)=>(((e,t,s)=>{t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const r={BEFORE_MERGE:"BEFORE_MERGE",AFTER_MERGE:"AFTER_MERGE"},n={clean:{enabled:!1,executionPlace:r.AFTER_MERGE,values:["",void 0,null]},logging:{enabled:!0,level:"warn"},validation:{enabled:!1,allowUnknown:!1,verbose:!0},webProperties:{enabled:!0,eventNamePattern:/.*/,reactiveUrl:!0,reactiveDimensions:!0}};class o{create(e){return"string"!=typeof e.event||0===e.event.length?{}:{context:{eventAction:e.event}}}}const l=(e,t)=>{let s;for(s in e)if(e&&e[s]&&!1===t(e[s],s))return!1;return!0},h=(e,t)=>l(e,((s,i)=>{for(const a in e[i])if(!1===t(s[a],a,s,i))return!1;return!0})),d=e=>{if(g(e))return!0;let t=0,s=0;return l(e,(e=>{t++,g(e)&&s++})),t===s},g=e=>{for(const t in e)return!1;return!0},c=(e,t=(e=>null==(e=n.clean)?void 0:e.values)()||[])=>(h(e,((s,i,a,r)=>{t.includes(s)&&(delete a[i],g(a)&&delete e[r])})),e),u=(e,t)=>e&&(h(e,((s,i,a,r)=>{t.includes(`${r.toString()}.${i.toString()}`)&&(delete a[i],g(a)&&delete e[r])})),e),m=e=>(l(e,((t,s)=>("function"!=typeof t||(e[s]=t()),!0))),h(e,((e,t,s)=>("function"!=typeof e||(s[t]=e()),!0))),e);class p{constructor(e,t=10){a(this,"tickInterval"),a(this,"callback"),a(this,"_tickTime",Date.now()),a(this,"_tickActive",!1),this.callback=e,this.tickInterval=1e3/t}start(){this._tickActive||(this._tickActive=!0,this.run())}stop(){this._tickActive=!1}run(){if(!this._tickActive)return;requestAnimationFrame(this.run.bind(this));const e=Date.now(),t=e-this._tickTime;t<this.tickInterval||(this._tickTime=e-t%this.tickInterval,this.callback())}}const y=(e,t)=>{const s=t.split(".");if(2!==s.length)return;const i=e[s[0]];return i?i[s[1]]:void 0},f=e=>{if(!e)return[];const t=[];return h(e,((e,s,i,a)=>{t.push(`${a.toString()}.${s.toString()}`)})),t},v=n.logging;var b=(e=>(e[e.error=0]="error",e[e.warn=1]="warn",e[e.log=2]="log",e))(b||{});const _=class e{constructor(e,t){a(this,"prefix"),a(this,"settings"),this.prefix=e,this.settings={...v,...t}}_getMergedSettings(e){return e?{...this.settings,...e}:this.settings}_isAllowed(t,s){if(!e.isAvailable||!s.enabled)return!1;const i=b[s.level];switch(t){case"error":case"warn":return i>=b[t];case"info":case"log":case"debug":case"dir":return i>=2;default:return!1}}_log(e,t="log",s){const i=this._getMergedSettings(s);this._isAllowed(t,i)&&("dir"===t?(console.log(`[${this.prefix}] ${t}:`),console[t](e)):console[t](`[${this.prefix}] ${e}`))}log(e,t){this._log(e,"log",t)}dir(e,t){this._log(e,"dir",t)}debug(e,t){this._log(e,"debug",t)}error(e,t){this._log(e,"error",t)}info(e,t){this._log(e,"info",t)}warn(e,t){this._log(e,"warn",t)}};a(_,"isAvailable",typeof console<"u");let w=_;const E=(...e)=>{const t={};return e.forEach((e=>{if(g(e))return;const s={...t,...e};let i;for(i in s)"object"!=typeof s[i]||Array.isArray(s[i])?t[i]=s[i]:t[i]={...t[i],...e[i]}})),t};class P{create(e){return c({context:{timestamp:e.timestamp,server:e.hostname},pageExperience:{pageId:e.url},visitor:{deviceBrowserBreakpoint:e.breakpoint,deviceBrowserHeight:e.height,deviceBrowserOrientation:e.orientation,deviceBrowserWidth:e.width,deviceType:e.deviceType,useragent:e.userAgent}},[void 0])}}const N=n.webProperties,x=()=>window.location.href.replace(/[?#].*/,""),L=()=>window.innerHeight.toString(),S=()=>window.innerHeight>window.innerWidth?"p":"l",R=()=>window.innerWidth.toString(),I=e=>{if(!e.breakpoints||e.breakpoints.length<1)return;const{breakpoints:t}=e,s=()=>{const e=window.innerWidth;let s=0,i=0;for(;i<t.length&&e>=t[i];)s=t[i],i++;return s.toString()};return e.reactiveDimensions?s:s()},U=(e,t)=>{const s={...N,...e},i={breakpoint:I(s),timestamp:(new Date).toISOString(),hostname:window.location.hostname,url:s.reactiveUrl?x:x(),height:s.reactiveDimensions?L:L(),orientation:s.reactiveDimensions?S:S(),width:s.reactiveDimensions?R:R(),deviceType:window.matchMedia("(hover: none), (pointer: coarse)").matches?"mobile":"desktop",userAgent:window.navigator.userAgent};return t?t.create(i):i},D=(e,t)=>{switch(t){case"string":case"number":case"boolean":return typeof e===t;case"any[]":return Array.isArray(e)&&e.length>0;case"Record<string, any>":return"object"==typeof e&&!Array.isArray(e)&&Object.keys(e).length>0;case"any":return!0;default:if(("boolean"==typeof e||"number"==typeof e||"string"==typeof e)&&t.indexOf("|")>0)return t.split("|").map((e=>{const t=e.trim();return/^'.*'$/.test(t)?t.replace(/(^ ?'?|'? ?$)/g,""):/^(true|false)$/.test(t)?"true"===t:/^-?(\d*\.)?\d+$/.test(t)?Number.parseFloat(t):t.replace(/(^ ?'?|'? ?$)/g,"")})).includes(e)}return!0},F=(e,t,s)=>{const i={level:null,issues:[]};if(!s.enabled||!s.eventMatrix)return i;const{events:a,...r}=s.eventMatrix,n=a.indexOf(e);if(-1===n)return i.level="error",i.issues.push({level:"error",type:"EVENT_NOT_FOUND",name:e,message:`'${e}': Event does not exist.`}),i;const o=f(t),l=Object.keys(r),h=o.filter((e=>!l.includes(e)));let d;for(d in h.length>0&&(s.allowUnknown||u(t,h),h.forEach((e=>{i.level=i.level??"warn",i.issues.push({level:"warn",type:"PROPERTY_DOES_NOT_EXIST",name:e,message:`'${e}': Property does not exist in the given Event Matrix.${s.allowUnknown?"":" It was omitted from the DataLayer payload."}`})}))),r){const e=r[d],a=typeof e.e[n]<"u",o=1===e.r,l=t?y(t,d):void 0,h=typeof l<"u";if(a&&o&&!h&&(i.level="error",i.issues.push({level:"error",type:"REQUIRED_PROPERTY_MISSING",name:d,message:`'${d}': The required property is missing.`}),!s.verbose)||h&&!D(l,e.t)&&(i.level="error",i.issues.push({level:"error",type:"WRONG_PROPERTY_TYPE",name:d,message:`'${d}': Wrong type detected. Expected '${e.t}', got '${typeof l}'.`}),!s.verbose))return i}return i};class A{constructor(e="DataLayerExtension",t){a(this,"_logger"),a(this,"_className"),a(this,"_dataLayerInstance"),this._className=e,this._logger=new w(this.className,t)}get dataLayerInstance(){return this._dataLayerInstance}set dataLayerInstance(e){this._dataLayerInstance=e}get className(){return this._className}set className(e){this._className=e}get isRegistered(){return typeof this._dataLayerInstance<"u"}}const T={eventName:"UNKNOWN",thresholds:{filled:.5,visible:.3,minValidityPeriod:1},triggerUpdates:{enabled:!1,eventName:"VIEWPORT_TRACKER_STATUS_CHANGE"},tickerSettings:{ticksPerSecond:10}};class k extends Event{constructor(e,t){super(e),a(this,"registeredElement"),this.registeredElement=t}}class V extends A{constructor(e){var t;super("ViewportTrackerExtension",null==e?void 0:e.logger),a(this,"settings"),a(this,"observer",null),a(this,"frameTicker"),a(this,"registeredElements",[]),a(this,"visibleElements",[]),this.settings=e?E(T,e):T,this.observer=this.createObserver(),this.frameTicker=new p(this.checkVisibilityOfElements.bind(this),null==(t=this.settings.tickerSettings)?void 0:t.ticksPerSecond)}createObserver(){return window&&"IntersectionObserver"in window?new IntersectionObserver(this.observerHandler.bind(this),{threshold:0,rootMargin:"0px 0px"}):(this._logger.error("The ViewportTrackerExtension will need IntersectionObserver to work."),null)}registerElement(e){var t;this.unregisterElement(e.el),this.registeredElements.push({el:e.el,properties:e.properties,state:{isFilled:!1,isVisible:!1,passedValidityPeriod:!1}}),null==(t=this.observer)||t.observe(e.el)}registerElements(e){for(const t of e)this.registerElement(t)}unregisterElement(e){var t;null==(t=this.observer)||t.unobserve(e);const s=this.getRegisteredElementIndex(e);s<0||this.registeredElements.splice(s,1)}unregisterElements(e){for(const t of e)this.unregisterElement(t)}getRegisteredElementIndex(e){return this.registeredElements.findIndex((t=>t.el===e))}getRegisteredElement(e){const t=this.getRegisteredElementIndex(e);if(!(t<0))return this.registeredElements[t]}observerHandler(e){for(const t of e){const e=t.target,s=this.getRegisteredElement(e);if(s){if(t.isIntersecting){-1===this.visibleElements.findIndex((e=>e===s.el))&&this.visibleElements.push(s.el);continue}this.removeFromVisibleStore(s.el),(s.state.isFilled||s.state.isVisible)&&requestAnimationFrame((()=>{this.processViewportIntersection(s,{isVisible:!1,isFilled:!1,passedValidityPeriod:!1})}))}}this.visibleElements.length>0&&this.frameTicker.start()}checkVisibilityOfElements(){if(0===this.visibleElements.length)return;const e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),t=window.scrollY;for(let s=0;s<this.visibleElements.length;s++){const i=this.visibleElements[s],a=this.getRegisteredElement(i);if(!a||!this.settings.triggerUpdates.enabled&&a.state.passedValidityPeriod)continue;const{isVisible:r,isFilled:n}=V.percentWithinViewport(i,t,e),o={isVisible:r>=this.settings.thresholds.visible,isFilled:n>=this.settings.thresholds.filled,passedValidityPeriod:a.state.passedValidityPeriod};this.processViewportIntersection(a,o)}}static percentWithinViewport(e,t,s){const i=t,a=t+s,r=e.getBoundingClientRect(),n=r.y+t,o=r.y+r.height+t,l=r.height;let h=l;n<i&&(h=l-(t-n)),o>a&&(h-=o-a);let d=h/l,g=h/s;return(i>o||a<n)&&(d=0,g=0),i<n&&a>o&&(d=1),n<i&&o>a&&(g=1),{isVisible:d,isFilled:g}}processViewportIntersection(e,{isVisible:t,isFilled:s}){const i=e.state||{isVisible:!1,isFilled:!1},a=Date.now(),r={isVisible:t,isFilled:s,timeVisible:i.isVisible!==t?a:i.timeVisible,timeFilled:i.isFilled!==s?a:i.timeFilled,passedValidityPeriod:i.passedValidityPeriod},n=e=>(a-e)/1e3;if(i.isVisible!==r.isVisible||i.isFilled!==r.isFilled)r.passedValidityPeriod=!1,e.state=r,this.dispatchEvent(e);else if(!r.passedValidityPeriod&&(r.isVisible||r.isFilled)){const i=n(r.timeVisible),a=n(r.timeFilled);(t&&i>=this.settings.thresholds.minValidityPeriod||s&&a>=this.settings.thresholds.minValidityPeriod)&&(r.passedValidityPeriod=!0,e.state=r,this.pushEvent(e),this.dispatchEvent(e))}}removeFromVisibleStore(e){let t=-1;for(;(t=this.visibleElements.findIndex((t=>t===e)))>=0;)this.visibleElements.splice(t,1);0===this.visibleElements.length&&this.frameTicker.stop()}pushEvent(e){if(!this.dataLayerInstance)return void this._logger.warn("This extension is not registered to a GlobalDataLayer instance.");const{properties:t}=e,s="function"==typeof t?t():t||{};this.dataLayerInstance.push(this.settings.eventName,s)}dispatchEvent(e){this.settings.triggerUpdates&&this.settings.triggerUpdates.enabled&&e.el.dispatchEvent(new k(this.settings.triggerUpdates.eventName,e))}}const M=e=>e.length>0,$="PageNameExtender_unknown_pageName",C={initialPageName:$,separator:"/"};class H extends A{constructor(e){super("PageNameExtenderExtension",null==e?void 0:e.logger),a(this,"settings"),a(this,"pageName",[]),a(this,"basePageNameLength",0),this.settings=e?E(C,e):C,this.set(this.settings.initialPageName)}set(e,t=!1){const s=this.basePageNameLength;return"string"==typeof e&&(e=e.split(this.settings.separator).filter(M)),0===e.length?(this._logger.warn("`pageName` must not be empty"),""):(e[0]===$&&this._logger.info("No `initialPageName` was provided. Make sure the `pageName` is provided later via the `set` method."),this.basePageNameLength=e.length,t&&e.push(...this.pageName.slice(s-1)),this.pageName=e,this.get())}get(e=!1){return(e?this.pageName.slice(0,this.basePageNameLength):this.pageName).join(this.settings.separator)}extend(e){return Array.isArray(e)&&(e=e.join(this.settings.separator)),0===(e=e.split(this.settings.separator).filter(M)).length?this._logger.warn("`levels` must not be empty"):this.pageName.push(...e),this.get()}reduce(e="last",t=!0){let s;return"all"===e?s=this.pageName.length-(t?this.basePageNameLength:1):"last"===e?s=this.pageName.length>(t?this.basePageNameLength:1)?1:0:(s=e,(this.pageName.length<=e||t&&this.pageName.length-this.basePageNameLength<e)&&(this._logger.info(`${this.pageName.length-(t?this.basePageNameLength:1)} - ${e} must not delete first level or more`),s=this.pageName.length-(t?this.basePageNameLength:1))),this.pageName.splice(-1*s,s),this.basePageNameLength>this.pageName.length&&(this.basePageNameLength=this.pageName.length),this.get()}getWithPrefix(e=""){return e+this.get()}getWithPostfix(e=""){return this.get()+e}}class O{constructor(e,t,s="GlobalDataLayer"){a(this,"_className"),a(this,"_settings"),a(this,"_defaultProperties"),a(this,"_logger"),a(this,"_webPropertiesHandled",!1),a(this,"_dataLayerStore"),a(this,"_extensions",new Map);const i=E(n,e||{});this._className=s,this._logger=new w(this._className,i.logging),this._settings=i,t?this._dataLayerStore=t:typeof window<"u"?(this._dataLayerStore=window.pagData=window.pagData||[],this._logger.info("`dataLayerStore` was set to default `window.pagData`")):(this._dataLayerStore=[],this._logger.info("`dataLayerStore` was set to default `[]`")),this._defaultProperties=[]}setup(){this._handleDefaultWebProperties()}get Settings(){return this._settings}get DataLayerStore(){return this._dataLayerStore}getRegisteredExtension(e){const t=new e;return this.getRegisteredExtensionByClassName(t.className)}getRegisteredExtensionByClassName(e){return this._extensions.has(e)?this._extensions.get(e):void 0}getRegisteredExtensions(){const e=[];for(const t of this._extensions.values())e.push(t);return e}registerExtension(e,t=!1){t||!this._extensions.has(e.className)?(e.dataLayerInstance=this,this._extensions.set(e.className,e),t?this._logger.info(`Overriden registration for extension class <${e.className}>.`):this._logger.info(`Registered extension class <${e.className}>.`)):this._logger.warn(`Tried to register extension class <${e.className}> which already exists.`)}removeExtension(e){const t=new e;this._extensions.has(t.className)?this._extensions.delete(t.className):this._logger.warn(`Tried to remove not existing extension class <${t.className}>.`)}removeExtensionByClassName(e){this._extensions.has(e)?this._extensions.delete(e):this._logger.warn(`Tried to remove not existing extension class <${e}>.`)}push(e,t=[{}],s){var i,a;if(0===e.length)return!1;const n=s&&!g(s)?E(this._settings,s):this._settings;Array.isArray(t)||(t=[t]),t.forEach(m);const o=this._eventNamePayloadFactory.create({event:e}),l=m(this.getDefaultProperties(e));n.clean.enabled&&n.clean.executionPlace===r.BEFORE_MERGE&&[l||{},...t].forEach((e=>c(e,n.clean.values)));const h=E(o,l||{},...t);if(n.clean.enabled&&n.clean.executionPlace===r.AFTER_MERGE&&c(h,n.clean.values),null!=(i=null==n?void 0:n.validation)&&i.enabled&&null!=(a=null==n?void 0:n.validation)&&a.eventMatrix){const t=F(e,h,n.validation),s=t.issues.sort(((e,t)=>e.level!==t.level&&"warn"===t.level?-1:0)).map((e=>`- [${e.level}]: ${e.message}`)).join("\n");switch(t.level){case"error":return this._logger.error(`Validation failed for event '${e}' with errors/warnings: \n${s}`,n.logging),!1;case"warn":this._logger.warn(`Validation success for event '${e}' with warnings: \n${s}`,n.logging);break;default:this._logger.info(`Validation success for event '${e}'.`,n.logging)}}return this._dataLayerStore.push(h),!0}getDefaultProperties(e){const t={byName:[],byArray:[],byRegex:[]};this._defaultProperties.forEach((s=>s.identifier===e?t.byName.push(s.data):Array.isArray(s.identifier)&&s.identifier.includes(e)?t.byArray.push(s.data):s.identifier instanceof RegExp&&s.identifier.test(e)?t.byRegex.push(s.data):void 0));const s=[...t.byRegex,...t.byArray,...t.byName];if(s.length)return E(...s)}setDefaultProperties(e,t){const s=this._defaultProperties.find((t=>t.identifier===e));s?s.data=E(s.data,t):this._defaultProperties.push({identifier:e,data:t})}_handleDefaultWebProperties(){if(this._webPropertiesHandled||!this._settings.webProperties.enabled)return;const e=U(this._settings.webProperties,this._webPayloadFactory);this.setDefaultProperties(this._settings.webProperties.eventNamePattern,e),this._webPropertiesHandled=!0}}class B extends O{constructor(e,t,s="GlobalDataLayer"){super(e,t,s),a(this,"_eventNamePayloadFactory"),a(this,"_webPayloadFactory"),this._eventNamePayloadFactory=new o,this._webPayloadFactory=new P,this.setup()}setup(){super.setup()}}}},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return s[e](r,r.exports,a),r.exports}a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e=a(343),t=a(184),window.GlobalDataLayer=e.GlobalDataLayer,window.dataLayerMerge=e.merge,window.GlobalDataLayerExtension={DataLayerExtension:e.DataLayerExtension,PageNameExtenderExtension:e.PageNameExtenderExtension,ViewportTrackerExtension:e.ViewportTrackerExtension,PcomLegacyCarDataHelperExtension:t.PcomLegacyCarDataHelperExtension,PcomLegacyHelperExtension:t.PcomLegacyHelperExtension}})();(function(n,t,i){"use strict";var r,h=n.GLOBAL_CONFIG&&n.GLOBAL_CONFIG.dataLayerSettings?n.GLOBAL_CONFIG.dataLayerSettings:{},c=_.getValueByName("dataLayerData",GLOBAL_CONFIG,i),l=_.getValueByName("dataLayerFormData",GLOBAL_CONFIG,i),a=!_.getValueByName("GDL",n)&&h.enable===!0&&h.enableGDL===!0&&c&&_.getValueByName("GlobalDataLayer",n,!1),o,e,u,f,s;a&&(s=_.getValueByName("GlobalDataLayerEventMatrix",n,i),r=new GlobalDataLayer({clean:{enabled:!0,values:["",i,null],executionPlace:"AFTER_MERGE"},validation:{enabled:typeof s!="undefined",eventMatrix:s},logging:{enabled:n.GLOBAL_CONFIG.LIVE!==!0,level:n.GLOBAL_CONFIG.isLocal===!0?"log":"warn"},webProperties:{enabled:!0,eventNamePattern:/.*/,breakpoints:[480,768,992,1200],reactiveUrl:!0,reactiveDimensions:!0}}),_.getValueByName("GlobalDataLayerExtension.ViewportTrackerExtension",n,!1)&&(o=new GlobalDataLayerExtension.ViewportTrackerExtension({eventName:"PAGPCOM_GeneralEnterViewport_Load"}),r.registerExtension(o)),_.getValueByName("GlobalDataLayerExtension.PcomLegacyHelperExtension",n,!1)&&(u=new GlobalDataLayerExtension.PcomLegacyHelperExtension({pageLoadEventName:"PAGPCOM_General_Pageload",pageNameSeparator:"/",pool:GLOBAL_CONFIG.pool,language:GLOBAL_CONFIG.language,region:GLOBAL_CONFIG.region,strictMode:!1}),r.registerExtension(u)),_.getValueByName("GlobalDataLayerExtension.PcomLegacyCarDataHelperExtension",n,!1)&&(e=new GlobalDataLayerExtension.PcomLegacyCarDataHelperExtension({carData:_.getValueByName("modelData",n,function(){try{return JSON.parse(_.getValueByName("body.dataset.model",t,null))||i}catch(n){return i}},!0)}),r.registerExtension(e)),_.getValueByName("GlobalDataLayerExtension.PageNameExtenderExtension",n,!1)&&(f=new GlobalDataLayerExtension.PageNameExtenderExtension({}),r.registerExtension(f)),r.setDefaultProperties(/^(PAGPCOM|PAGGeneric)_.*/,n.dataLayerMerge({context:{applicationName:"unknown",environment:function(){switch(!0){case n.location.hostname.match(/(^$|local|dev|udg)/)!==null:return"K";case n.location.hostname.match(/(preview|ppn)/)!==null:return"PP";default:return"P"}}()},pageExperience:{pageName:function(){return u.didPathNameChange("pageExperience/pageName")&&f.set(u.getPageNameByUrl()),f.get()}},car:function(){return e.byUrl()}},c)),r.setDefaultProperties(/^PAGPCOM_.*/,l),u.pushPageLoadOnPathNameChange());n.GDL=r;n.GDLPageNameExtender=f;n.GDLViewportTracker=o;n.GDLHelper=u;n.GDLCarDataHelper=e})(this,this.document);